package com.kyraltre.trelibrary.mixin;

import com.alaharranhonor.swem.forge.client.model.SWEMHorseModel;
import com.alaharranhonor.swem.forge.client.render.SWEMHorseRenderer;
import com.alaharranhonor.swem.forge.entities.horse.SWEMHorseEntity;
import com.alaharranhonor.swem.forge.items.tack.LegWrapsItem;
import net.minecraft.client.renderer.entity.EntityRendererProvider;
import net.minecraft.world.item.ItemStack;
import org.spongepowered.asm.mixin.Mixin;
import org.spongepowered.asm.mixin.injection.At;
import org.spongepowered.asm.mixin.injection.Inject;
import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;
import software.bernie.geckolib.renderer.DynamicGeoEntityRenderer;

import java.util.Arrays;


@Mixin(SWEMHorseRenderer.class)
public abstract class LegWrapsRendererMixin extends DynamicGeoEntityRenderer<SWEMHorseEntity> {

    // Adds the knee and upper legs to the leg wrap bones

    private static final String[] LEG_WRAPS_SHOW_BONE_NAMES = new String[]{
            "FrontLeftKnee", "FrontLeftLeg", "FrontRightLeg", "FrontRightKnee",
            "BackLeft", "Thigh", "KneeLeft", "BackRight", "Thigh2", "KneeRight",
            "LegWrapsSkull", "LegWrapsBridgeOfNose", "LegWrapsEarLeft", "LegWrapsEarRight",
            "LegWrapsMiddle",
            "LegWrapsBackRight", "LegWrapsBackRightHoof", "LegWrapsBackLeft", "LegWrapsBackLeftHoof",
            "LegWrapsFrontRight", "LegWrapsBackFrontHoof", "LegWrapsFrontLeft", "LegWrapsBackFrontLeft"};

    private static final String[] LEG_WRAPS_HIDE_BONE_NAMES = new String[]{
            "LegWrapsSkull", "LegWrapsBridgeOfNose", "LegWrapsEarLeft", "LegWrapsEarRight", "LegWrapsMiddle",
            "LegWrapsBackRight", "LegWrapsBackRightHoof", "LegWrapsBackLeft", "LegWrapsBackLeftHoof",
            "LegWrapsFrontRight", "LegWrapsBackFrontHoof", "LegWrapsFrontLeft", "LegWrapsBackFrontLeft"};


    protected LegWrapsRendererMixin(EntityRendererProvider.Context renderManagerIn) {
        super(renderManagerIn, new SWEMHorseModel());
    }

////     This Injection resets the ENTIRE check legwrap method to reset the bones that are called.
    @Inject(
            at = @At(value = "HEAD"),
            method = "checkLegWrapsForRendering",
            cancellable = true,
            remap = false
    )
    private void checkLegWrapsForRendering(SWEMHorseEntity entity, CallbackInfo info) {
        info.cancel();

        ItemStack stack = entity.getLegWraps();
        if (stack.getItem() instanceof LegWrapsItem) {
            Arrays.stream(LEG_WRAPS_SHOW_BONE_NAMES).forEach((n) -> {
                this.showBone(n, entity);
            });
        } else {
            Arrays.stream(LEG_WRAPS_HIDE_BONE_NAMES).forEach((n) -> {
                this.hideBone(n, entity);
            });
        }

    }

/// The bone calls

    public void hideBone(String boneName, SWEMHorseEntity entity) {
        this.getGeoModel().getBakedModel(this.getGeoModel().getModelResource(entity)).getBone(boneName).ifPresent((bone) -> {
            bone.setHidden(true);
        });
    }

    public void showBone(String boneName, SWEMHorseEntity entity) {
        this.getGeoModel().getBakedModel(this.getGeoModel().getModelResource(entity)).getBone(boneName).ifPresent((bone) -> {
            bone.setHidden(false);
        });
    }

}
